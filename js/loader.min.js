var index,config={};function setConfigs(){localStorage.getItem(config.site+"configs"),null==localStorage.getItem(config.site+"configs")?(config.commitTime=1e3,config.base="https://dev.azure.com",config.vs="https://vssps.dev.azure.com/kukhanya",config.fileserver="",config.org="kukhanya",config.project="FormForm",config.projectCSS="CSS",config.url_org=config.base+"/"+config.org,config.repo_proj="Sunglass",config.url_proj=config.url_org+"/"+config.project,config.url_projCSS=config.url_org+"/"+config.projectCSS,config.version="api-version=6.0",config.path_workitems="_apis/wit/workitems?ids=###ids###&"+config.version,config.path_workitem="_apis/wit/workitems/###ids###?"+config.version+"&$expand=all",config.path_wiql="_apis/wit/wiql?"+config.version,config.path_batch="_apis/wit/workitemsbatch?"+config.version,config.path_repo="_apis/git/repositories?"+config.version,config.path_commit="_apis/git/repositories/###id###/commits?&$top=1&searchCriteria.refName=refs/heads/main&"+config.version,config.path_push="_apis/git/repositories/###id###/pushes?"+config.version,config.path_token="_apis/tokens/pats?api-version=7.1-preview.1",config.path_comment="_apis/wit/workitems/###id###/comments?"+config.version+"-preview.3",config.path_getcomment="_apis/wit/workitems/###wid###/comments/###id###?"+config.version+"-preview.3",config.user=localStorage.getItem(config.site+"userId"),config.path_session="_apis/Token/SessionTokens?"+config.version+"-preview",config.team="FormFormTeam",config.url_team=config.url_proj+"/"+config.team,config.tokenDate="",config.addlog=["onload","loadRepos","Exception"],config.removelog=["context"],config.addcomment=[],config.removecomment=[],config.postsource=["getUpdatedWI","addWIs","uploadImage","processComment","loadComment"],config.getsource=["loadCommit","processComment","loadComment","loadToken"],config.repoitems=["loadToken","loadCommit","getUpdatedWI","addWIs","processComment","loadComment","uploadImage"],config.repo="",config.key="",config.device="",config.maxDate="",config.maxId,config.cssCount=0,config.logId=16923,config.whatsapp="https://api.whatsapp.com/send?phone=27726359342&text=AccessSunglass",config.email="mailto:bonganihlong@icloud.com?subject=RequestAccess&body=AccessSunglass",saveConfig()):config=JSON.parse(localStorage.getItem(config.site+"configs"))}function saveConfig(){localStorage.setItem(config.site+"configs",JSON.stringify(config))}config.site="BusiSomething";var idsArr=[];function getId(e){if(e.includes("workitems/")||e.includes("workItems/")){var t=e.indexOf("workitems/");-1==t&&(t=e.indexOf("workItems/"));var n=e.indexOf("?");return e.substring(t+10,-1==n?e.length:n)}}function all(e,t,n,i,a,r){if(0!=a.length){log("all","allstart","Getting from post: "+i+e+"--"+l+a[0]+r,ln());var s=getId(e),l=(btoa(i+e+key).hashCode()+"").replace("-","C");log("all","allstart","Getting from post: "+i+e+"--"+l+a[0]+r+s,ln()),window.indexedDB.open(config.site+"Database").onsuccess=function(c){try{s=void 0==s?0:s;var g=c.target.result.transaction("workitems","readwrite").objectStore("workitems").get(s);g.onsuccess=function(c){s>0?window.indexedDB.open(config.site+"Database").onsuccess=function(c){var g=c.target.result.transaction("workitems","readwrite").objectStore("workitems").get(Number(s));g.onsuccess=function(c){void 0!=c.target.result?(s!=config.maxId&&removeWI(s),allRequest(e,t,n,i,["online"],r,l)):allRequest(e,t,n,i,a,r,l)},g.onerror=function(s){allRequest(e,t,n,i,a,r,l)}}:allRequest(e,t,n,i,a,r,l)},g.onerror=function(s){allRequest(e,t,n,i,a,r,l)}}catch(d){}}}}function allRequest(e,t,n,i,a,r,s){var l=e;switch(a[0]){case"online":l=e+"#/"+s+"##refresh#";break;case"onlinecache":l=e;break;case"site":l=config.fileserver+"images/"+s+".js#online#";break;case"sitecache":l=config.fileserver+"images/"+s+".js"}var c=r?"GET":a[0].includes("online")?"POST":"GET",g="GET"==c?null:t;$.ajax({url:l,type:c,data:g,async:!0,headers:{MainUrl:e,CacheUrl:s+".js",Online:a[0],"Item-Requested":i,Authorization:"Basic "+key,"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},cache:!0,success:function(l,c,g){200==g.status?(log("all","success","Calling handler: "+i+e+"--"+s+a[0]+r,ln()),handleCaller(l,s,n,i,a[0])):(a.shift(),all(e,t,n,i,a,r))},failure:function(s,l,c){log("all","onfailure","Not found "+e+i,ln()),a.shift(),all(e,t,n,i,a,r)},error:function(s,l,c){if(log("all","Error1","Not found "+e+i,ln()),(408==s.status||404==s.status)&&(a.shift(),all(e,t,n,i,a,r)),400==s.status&&i.includes("uploadImage")&&s.responseJSON.message.includes("specified in the add operation already exists")){var g=s.responseJSON.message.indexOf("/images/"),d=s.responseJSON.message.indexOf(".js"),m=s.responseJSON.message.substring(g,d-g+13);t=JSON.parse(t);for(var u=!1,p=t.commits[0].changes.length-1;p>=0;p--)"add"==t.commits[0].changes[p].changeType&&t.commits[0].changes[p].item.path==m&&(t.commits[0].changes.splice(p,1),u=!0);u&&t.commits[0].changes.length>0&&all(e,JSON.stringify(t),n,i,["online"],r)}log("all","Error3","Done."+i,ln())}})}function search(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function searchIncludes(e,t){for(var n=0;n<t.length;n++)if(e.includes(t[n]))return!0;return!1}function post(e,t,n,i){all(e,t,n,i,["online"],!1)}function get(e,t,n,i){all(e,null,t,n,void 0==i||null==i?["sitecache","onlinecache","site","online"]:i,!0)}function handleCaller(e,t,n,i,a,r){if(log("handleCaller","context",i+e,ln()),""!=e&&null!=e&&void 0!=e&&(log("handleCaller","handleCaller","Starting Callback"+i,ln()),n(e),log("handleCaller","handleCaller","Starting to repo "+i,ln()),!searchIncludes(i,config.repoitems))){var s=JSON.stringify(e);"online"==a&&(log("handleCaller","handleCaller","Calling repoImage "+i,ln()),repoImage("",s,t+".js","rawtext"),log("handleCaller","handleCaller","Done repoImage "+i,ln())),log("handleCaller","handleCaller","Finished repoImage "+i,ln())}}function fileExists(e){if(!e)return!1;var t=new XMLHttpRequest;return t.open("GET",e,!1),t.setRequestHeader("Item-Requested",item),t.send(),200==t.status}function getText(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Item-Requested",item),t.send(null),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status&&1!==t.getResponseHeader("Content-Type").indexOf("text"))return t.responseText}}function saveToken(){var e=$("#userId").val().split(":");e.length>1?config[e[0]]=e[1]:(config.user=e,config.token=$("#tokenId").val(),localStorage.setItem(config.site+"userId",config.user),localStorage.setItem(config.site+"token",config.token),$("#accessModal").modal("hide"),saveConfig())}async function fetchWithAuthentication(e,t){let n=new Headers;return n.set("Authorization",t),n.set("Access-Control-Allow-Origin","*"),n.set("Accept-Encoding","gzip,deflate"),n.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),await fetch(e,{headers:n})}async function displayProtectedImage(e,t,n,i){try{let a=await fetchWithAuthentication(t,n),r=a.blob(),s=window.URL.createObjectURL(r),l=document.getElementById(e);l.src=s,document.getElementById(e+"_div").style.display="block"}catch(c){logError("displayProtectedImage","Exception",t+":"+e+i,ln(),c)}}document.onkeyup=function(){var e=e||window.event;if(e.altKey&&65==e.which)return $("#accessModal").modal("show"),!1};var objs=[];function repoImage(e,t,n,i,a){for(var r=e.split("/").pop()+n,s=!1,l=0;l<objs.length;l++)objs[l].filename==r&&(s=!0);if(""!=r&&!s){var c={};if(c.filename=r,c.base64=t,c.type=i,objs.push(c),objs.length<1)return}if(""==config.repo){if(console.log("No repo: "+e+n),a)return;setTimeout(repoImage(e,t,n,i,!0),1e3);return}if(""==commit){console.log("No commit: "+e+n);return}for(var g=[],l=0;l<objs.length;l++){var d={changeType:"add",item:{path:"/images/"+objs[l].filename},newContent:{content:""+objs[l].base64,contentType:""+objs[l].type}};g.push(d)}var m=JSON.stringify({refUpdates:[{name:"refs/heads/main",oldObjectId:""+commit}],commits:[{comment:"Added new image file.",changes:g}]});objs.length>0&&prepareCall(repo,m,"uploadImage"),objs.length>5&&(objs=[])}function createToken(e){var t=localStorage.getItem("RequestToken");void 0==t||null==t?prepareCall(e,JSON.stringify({text:"Request: "+site+document.getElementById("userId").innerHTML+device}),"getToken"):prepareCall(t,"","getComment",wid)}function addComment(e){prepareCall(config.logId,JSON.stringify({text:config.user+": "+config.site+":"+e}),"processComment")}function processComment(e){getResult(e)}function getToken(e){var t=getResult(e);localStorage.setItem("RequestToken",t.id)}function getComment(e){try{var t=getResult(e).text.split(";");document.getElementById("newToken").innerHTML=t.length>1?t[1]:"New Token Requested"}catch(n){logError("getComment","Exception",e,ln(),n)}}function uploadImage(e){getResult(e).commits.length>0&&objs.shift()}function loadConfig(e){try{var t=getResult(e),n="",i="";for(var a in t.workItems)n+=i+""+t.workItems[a].id,i=",";prepareCall(n,"","loadConfigItems")}catch(r){logError("loadConfig","Exception",e,ln(),r)}}function loadConfigItems(e){var t=getResult(e),n="",i="";for(var a in t.value)n+=i+""+t.value[a].id,i=",";prepareCall(n,"","loadConfigValues")}function loadConfigValues(e){var t=getResult(e);for(var n in t.value)config[t.value[n].fields["System.Title"]]=t.value[n].fields["Custom.Text"];saveConfig()}function en(e){var t,n="charCodeAt",i={},a=e.split(""),r=[],s=a[0],l=256;for(t=1;t<a.length;t++)null!=i[s+(e=a[t])]?s+=e:(r.push(1<s.length?i[s]:s[n](0)),i[s+e]=l,l++,s=e);for(r.push(1<s.length?i[s]:s[n](0)),t=0;t<r.length;t++)r[t]=String.fromCharCode(r[t]);return r.join("")}function de(e){var t,n={},i=e.split(""),a=f=i[0],r=[a],s=o=256;for(e=1;e<i.length;e++)t=s>(t=i[e].charCodeAt(0))?i[e]:n[t]?n[t]:f+a,r.push(t),a=t.charAt(0),n[o]=f+a,o++,f=t;return r.join("")}String.prototype.hashCode=function(){var e,t,n=0;if(0===this.length)return n;for(e=0;e<this.length;e++)n=(n<<5)-n+(t=this.charCodeAt(e)),n|=0;return n},String.prototype.replaceAllEx=function(e,t){return this.includes(e)?this.replace(e,t).replaceAllEx(e,t):this},Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t};var repo="";function getObject(e,t,n,i,a,r){if(i.length>a){var n=n[i[a]];return getObject(e,t,n,i,++a,r)}return r==n?e[t]:e.length>t?getObject(e,++t,e[t],i,0,r):null}function loadRepos(e){log("loadRepos","loading repo","Getting repos",ln());var t=getResult(e);log("loadRepos","loading repo","RepoID:"+(repo=getObject(t.value,0,t.value[0],["project","name"],0,"Sunglass").id),ln()),fetchCommit(),config.repo!=repo&&""!=repo&&(config.repo=repo,saveConfig())}var commitTime=0;function fetchCommit(){0==commitTime&&(commitTime=config.commitTime),prepareCall(repo,"","loadCommit"),setTimeout("fetchCommit()",commitTime),commitTime*=1.2}var commit="",tries=0;function loadCommit(e){var t=getResult(e);if(t.value.length>0){var n=commit;commit=t.value[0].commitId,console.log("Commit ID: "+commit),n!=commit||3==tries?(repoImage("","","",""),tries=0):tries+=1}}function formatDate(e){var t=new Date(e),n=""+(t.getMonth()+1),i=""+t.getDate(),a=t.getFullYear();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),[a,n,i].join("-")}function loadQueries(e){var t=getResult(e);for(var n in t.workItems)prepareCall(t.workItems[n].id,"","getItemValue")}function getItemValue(e){var t,n=getResult(e),i=n.fields["System.Title"];switch(i){case"ConfigQuery":t=loadConfig;break;case"FlexQuery":t=loadFlex;break;case"CarouselQuery":t=window[n.fields["Custom.Text"]];break;case"ImageQuery":t=loadImages;break;case"MenuQuery":t=loadMenu;break;case"ThumbnailQuery":t=loadThumbs;break;case"PageQuery":t=loadPageInfo}return post(config.url_team+"/"+config.path_wiql,JSON.stringify({query:""+stripHtml(n.fields["Custom.Data"])}),t,i),loadRelation(n.relations,n.fields["Custom.Text"]),n.fields["Custom.Text"]}function loadImages(e){for(var t=getResult(e),n=0;n<t.workItems.length;n++)prepareCall(result.workItems[n].id,"","loadImageItem")}function loadImageItem(e){var t=getResult(e),n=getObject(t.relations,0,t.relations[0],["rel"],0,"AttachedFile"),i=n.url,a=n.attributes.name,r=i.split("/").pop();$.get(config.fileserver+"images/"+r+a).done(function(){$("#"+t.fields["Custom.Text"]).attr("src",config.fileserver+"images/"+r+a)}).fail(function(){displayProtectedImage(t.fields["Custom.Text"],i,"Basic "+key,a)})}function stripHtml(e){var t=document.createElement("DIV");t.innerHTML=e;var n=(e=t.textContent||t.innerText||"").indexOf("config[");if(-1!=n){var i=e.indexOf("]",n);e=e.substring(0,n)+config[e.substring(n+7+1,i-1)]+e.substring(i+1)}return minify(e)}function minify(e){return e.replace(/^\s+|\r\n|\n|\r|(>)\s+(<)|\s+$/gm,"$1$2")}function stripScript(e,t){var n=document.createElement("DIV");return n.innerHTML=e,-1!=(e=n.textContent||n.innerText||"").indexOf("TEXTDIV")&&(e=e.replaceAllEx("TEXTDIV",t)),e}function loadToken(e){var t=getResult(e);getObject(t.value,0,t.value[0],["displayName"],0,config.site+config.user).validTo,document.getElementById("tokenDateId").innerHTML="Valid until "+formatDate(new Date().toString("YY MM DD")),document.getElementById("newTokenBtn").disabled=!1}function unMaskToken(e){var t=e.substring(0,6);e=e.substring(6);for(var n="",i=0;i<6;i++){var a=e.indexOf(t[i]);n+=e.substring(0,a),e=e.substring(a+1)}return n+e}function logError(e,t,n,i,a){log("Exception",e+t,n+a.stack,i)}function log(e,t,n,i){var a=!1,r=!1;config.addlog.includes(e)&&(a=!0),config.addcomment.includes(e)&&(r=!0),config.addlog.includes(t)&&(a=!0),config.addcomment.includes(t)&&(r=!0),config.removelog.includes(t)&&(a=!1),config.removecomment.includes(t)&&(r=!1),config.removelog.includes(e)&&(a=!1),config.removecomment.includes(e)&&(r=!1),a&&console.log(i+"-"+e+":"+t+":"+n),r&&"prepareCallException"!=t&&"addComment"!=t&&addComment(i+"-"+e+":"+t+":"+n)}function ln(){var e=Error();if(!e.stack)try{throw e}catch(t){if(!t.stack)return 0}var n=e.stack.toString().split(/\r\n|\n/),i=/:(\d+):(?:\d+)[^\d]*$/;do var a=n.shift();while(!i.exec(a)&&n.length);return i.exec(n.shift())[1]}function getCurentDate(){return"2022-09-15"}function sendAccessWhatsapp(){window.location.href=config.whatsapp}function sendAccessEmail(){window.location.href=config.email}function menuHtml(e){try{var t=getResult(e);for(var n in t.workItems)prepareCall(t.workItems[n].id,"","getHtml")}catch(i){logError("menuHtml","Exception","",ln(),i)}}function getHtml(e){try{var t=getResult(e);document.getElementById(t.fields["Custom.Text"]).innerHTML=stripHtml(t.fields["Custom.Data"]).replace("&nbsp","").replaceAllEx("###Title###",t.fields["System.Title"]).replaceAllEx("###Description###",t.fields["System.Description"]),loadRelation(t.relations)}catch(n){logError("getHtml","Exception",e,ln(),n)}}function getRelay(e){try{var t=getResult(e),n=t.fields["Custom.Text"];if((void 0==n||null==n)&&(n=""),"Batch"==n)loadRelation(t.relations,n);else if(void 0!=t.relations&&(loadRelation(t.relations,n),""!=n)){var i=n.split("/");i.length>1&&prepareCall(i[1],"","getRelay")}}catch(a){logError("getRelay","Exception",e,ln(),a)}}function getRelaysWiql(e){var t=getResult(e);for(var n in t.workItems)prepareCall(t.workItems[n].id,"","getRelayEx")}function getUpdatedWI(e){var t=getResult(e),n=[];for(var i in t.workItems)n.push(parseInt(t.workItems[i].id));n.length>0&&prepareCall("",JSON.stringify({ids:n,fields:["System.Id","System.ChangedDate"]}),"addWIs")}window.onload=function(){if(setConfigs(),repo=config.repo,document.title=config.site,null==unMaskToken(localStorage.getItem(config.site+"token"))){$("#accessModal").modal("show");return}key=btoa(":"+unMaskToken(localStorage.getItem(config.site+"token"))),log("onload","startlog","Getting Repo",ln()),prepareCall("",e,"loadRepos"),log("onload","startlog","Starting loading",ln()),createDB(),log("onload","startlog","Getting last date",ln()),getLastDate(),log("onload","startlog","Getting Tokens",ln()),prepareCall("","","loadToken"),log("onload","startlog","Getting First Entry",ln());var e=JSON.stringify({query:"Select [System.Id], [System.Title], [System.Description], [Custom.Text] From WorkItems Where [State] <> 'Closed' AND [State] <> 'Removed' AND [System.WorkItemType] = 'Feature' AND [Custom.Type] = 'Relay' AND [Custom.Order] = 0 AND [System.AssignedTo] = @me"});prepareCall("",e,"getRelaysWiql"),log("onload","startlog","Getting Device",ln()),log("onload","endlog","End loading for device:"+(device=new DeviceUUID().get()),ln()),document.getElementById("main").style.display="block"};var installDate="2022-09-07";function getLastDate(){window.indexedDB.open(config.site+"Database").onsuccess=function(e){try{var t=e.target.result.transaction("workitems","readwrite").objectStore("workitems").index("by_date").openCursor(null,"prev");t.onsuccess=function(){var e=t.result;e?(config.maxDate=e.key,config.maxId=e.value.id):(""==config.maxDate&&(config.maxDate=getCurentDate().substring(0,10)),""==config.maxDate&&(config.maxDate=installDate),config.maxId="-1"),log("onload","startlog","Getting Updated Work Items",ln());var n=JSON.stringify({query:"Select [System.Id]From WorkItems Where [State] <> 'Closed' AND [State] <> 'Removed' AND [System.WorkItemType] = 'Feature' AND [System.ChangedDate] >= '"+config.maxDate.substring(0,10)+"'"});prepareCall("",n,"getUpdatedWI")}}catch(n){config.maxDate=installDate,prepareCall("",JSON.stringify({query:"Select [System.Id]From WorkItems Where [State] <> 'Closed' AND [State] <> 'Removed' AND [System.WorkItemType] = 'Feature' AND [System.ChangedDate] >= '"+config.maxDate.substring(0,10)+"'"}),"getUpdatedWI")}}}function addWIs(e){var t=getResult(e);for(var n in t.value){var i={};i.id=t.value[n].fields["System.Id"],i.date=t.value[n].fields["System.ChangedDate"],Date.parse(i.date)>Date.parse(config.maxDate)&&getWI(i)}}function getWI(e,t){window.indexedDB.open(config.site+"Database").onsuccess=function(n){var i=n.target.result.transaction("workitems","readwrite").objectStore("workitems").get(Number(e.id));i.onsuccess=function(n){t?get(config.url_org+"/"+config.path_workitem.replace("###ids###",e.id),getGeneric,"getGeneric"+e.id,!0):updateWI(e)},i.onerror=function(t){addWI(e)}}}function updateWI(e){window.indexedDB.open(config.site+"Database").onsuccess=function(t){return t.target.result.transaction("workitems","readwrite").objectStore("workitems").put(e)}}function removeWI(e){window.indexedDB.open(config.site+"Database").onsuccess=function(t){var n=t.target.result.transaction("workitems","readwrite").objectStore("workitems").delete(Number(e));n.onsuccess=function(e){},n.onerror=function(e){}}}function CreateObjectStore(e,t){indexedDB.open(e).onsuccess=function(n){var i=n.target.result,a=parseInt(i.version);i.close();var r=indexedDB.open(e,a+1);r.onupgradeneeded=function(e){try{var n=e.target.result.createObjectStore(t,{keyPath:"id"});n.createIndex("by_date","date"),n.createIndex("id","id",{unique:!0})}catch(i){}},r.onsuccess=function(e){e.target.result.close()}}}function createDB(){var e=window.indexedDB.open(config.site+"Database");e.onupgradeneeded=function(e){log("createDB","creatingstore","Starting to create store",ln());var t=e.target.result.createObjectStore("workitems",{keyPath:"id"});t.createIndex("by_date","date"),t.createIndex("id","id",{unique:!0})},e.onerror=e=>{console.error(`Database error: ${e.target.errorCode}`)},e.onsuccess=e=>{CreateObjectStore(config.site+"Database","workitems")},log("createDB","creatingstore","Store created",ln())}function addWI(e){window.indexedDB.open(config.site+"Database").onsuccess=function(t){t.target.result.transaction("workitems","readwrite").objectStore("workitems").put(e)}}function getRelays(e){var t=getResult(e);if(t.workItems.length>0)for(var n in t.workItems)prepareCall(t.workItems[n].id,json,"getRelayEx")}function getResult(e){var t=e;try{t=JSON.parse(e),t=JSON.parse(t)}catch(n){}return t}function loadCssFile(e){var t=document.createElement("link");t.id="myCss",t.rel="stylesheet",t.type="text/css",t.href=e,t.media="all",document.getElementsByTagName("head")[0].appendChild(t)}function getGeneric(e){var t,n,i=getResult(e);if("Active"==i.fields["System.State"]){switch(i.fields["Custom.Type"]){case"Html":n=getHtml,t="getHtml";break;case"Css":n=getCss,t="getCss";break;case"Relay":n=getRelay,t="getRelay";break;case"Query":n=getItemValue,t="getItemValue";break;case"Script":n=getScript,t="getScript";break;case"Image":n=loadImageItem,t="loadImageItem"}get(config.url_proj+"/"+config.path_workitem.replace("###ids###",i.id),n,t+i.id)}}function loadScript(e){try{var t=getResult(e);for(var n in t.workItems)prepareCall(t.workItems[n].id,i,"getScript");var i=JSON.stringify({query:"Select [System.Id], [System.Title], [System.Description] From WorkItems Where [State] <> 'Closed' AND [State] <> 'Removed' AND [System.WorkItemType] = 'Feature' AND [Custom.Type] = 'Query' order by [Custom.Order] asc"});prepareCall("",i,"loadQueries")}catch(a){logError("loadScript","Exception",e,ln(),a)}}function loadCss(e){try{var t=getResult(e);for(var n in t.workItems)prepareCall(t.workItems[n].id,json,"getCss")}catch(i){logError("loadScript","Exception",e,ln(),i)}}function getCss(e){try{var t=getResult(e);if(t.fields["Custom.Data"].includes("@import")){var n=stripHtml(t.fields["Custom.Data"]).split("@import url(");for(var i in n)loadCssFile(n[i].replace(");",""))}else void 0!=t.fields["Custom.Text"]?$("head").append("<style id='"+t.fields["System.Title"]+"' >"+t.fields["Custom.Text"]+"{"+stripHtml(t.fields["Custom.Data"].replaceAllEx("]]",";"))+"}</style>"):$("head").append("<style id='"+t.fields["System.Title"]+"' >"+stripHtml(t.fields["Custom.Data"])+"</style>");loadRelation(t.relations,t.fields["Custom.Text"])}catch(a){logError("getCss","Exception",e,ln(),a)}}function getScript(e){try{var t=getResult(e),n=document.createElement("script");n.text=stripScript(t.fields["Custom.Data"].replaceAllEx("###Text###",t.fields["Custom.Text"]),t.fields["System.Title"]),document.body.appendChild(n)}catch(i){logError("getScript","Exception",e,ln(),i)}}function prepareCall(e,t,n,i){var a,r,s,l=[];try{switch(n){case"getToken":a=config.url_proj+"/"+config.path_comment,r=getToken,s=!0;break;case"getComment":a=config.url_proj+"/"+config.path_comment,r=getComment,s=!1;break;case"processComment":a=config.url_proj+"/"+config.path_comment,r=processComment,s=!0;break;case"loadConfigItems":a=config.url_proj+"/"+config.path_workitems,r=loadConfigItems,s=!1;break;case"loadConfigValues":a=config.url_proj+"/"+config.path_workitems,r=loadConfigValues,s=!1;break;case"loadCommit":a=config.url_org+"/"+config.repo_proj+"/"+config.path_commit,r=loadCommit,s=!1;break;case"getItemValue":a=config.url_proj+"/"+config.path_workitem,r=getItemValue,s=!1;break;case"loadImageItem":a=config.url_proj+"/"+config.path_workitem,r=loadImageItem,s=!1;break;case"loadToken":a=config.vs+"/"+config.path_session,r=loadToken,s=!1,l=["online","sitecache","site","onlinecache"];break;case"getRelaysWiql":a=config.url_team+"/"+config.path_wiql,r=getRelaysWiql,s=!0;break;case"loadRepos":a=config.url_org+"/"+config.path_repo,r=loadRepos,s=!1,l=["online","sitecache","site","onlinecache"];break;case"getHtml":a=config.url_proj+"/"+config.path_workitem,r=getHtml,s=!1;break;case"getRelay":a=config.url_org+"/"+config.path_workitem,r=getRelay,s=!1;break;case"getRelayEx":a=config.url_proj+"/"+config.path_workitem,r=getRelay,s=!1;break;case"addWIs":a=config.url_org+"/"+config.path_batch+"#/online#",r=addWIs,s=post;break;case"getUpdatedWI":a=config.url_team+"/"+config.path_wiql+"#/online#",r=getUpdatedWI,s=!0;break;case"loadQueries":a=config.url_team+"/"+config.path_wiql,r=loadQueries,s=!0;break;case"getScript":a=config.url_proj+"/"+config.path_workitem,r=getScript,s=!1;break;case"getCss":a=config.url_proj+"/"+config.path_workitem,r=getCss,s=!1;break;case"uploadImage":a=config.url_org+"/"+config.path_push,r=uploadImage,s=!0}0==l.length&&(l=["sitecache","onlinecache","site","online"]);var c=a.includes("###ids###")?"###ids###":"###id###";s?post(a.replace(c,e),t,r,n+e):get(a.replace("###wid###",i).replace(c,e),r,n+e,l)}catch(g){console.log(g),logError("prepareCall","Exception",n,ln(),g)}}var globalcss=null,cssDone=!1;function findTypes(e,t){var n=[];for(var i in e)e[i].fields["Custom.Type"]==t&&n.push(e[i]);return n}var cssCount=0;function getRelation(e){var t=getResult(e);console.log("getRelation");var n=findTypes(t.value,"Css"),i=findTypes(t.value,"Html"),a=findTypes(t.value,"Relay");for(var r in findTypes(t.value,"Script"),a){if(void 0!=a[r].fields["Custom.Text"]&&""!=a[r].fields["Custom.Text"]){var s=a[r].fields["Custom.Text"].split("/");s.length>1&&get(config.url_org+"/"+s[0]+"/"+config.path_workitem.replace("###ids###",s[1]),getGeneric,"getGeneric"+s[1])}get(config.url_proj+"/"+config.path_workitem.replace("###ids###",a[r].fields["System.Id"]),getGeneric,"getGeneric"+a[r].fields["System.Id"])}if(console.log("cssCount: "+cssCount),document.getElementById("main").style.display="block",document.getElementById("loader_div").style.display="none",n.length>0){if(null==globalcss)globalcss=n,cssCount++;else if(4==cssCount){n=globalcss=globalcss.concat(n);var l="";for(var r in n){var c="AuxData"==n[r].fields["Custom.Text"]?n[r].fields["Custom.AuxData"]:n[r].fields["Custom.Text"],g=stripHtml(n[r].fields["Custom.Data"].replaceAllEx("]]",";"));if(n[r].fields["Custom.Text"].startsWith("@media")){var d=g.split("###"),m=stripHtml(n[r].fields["Custom.AuxData"]).split("###"),u="";for(var p in d)u+=stripHtml(d[p]).replaceAllEx(";",">")+"{"+stripHtml(m[p])+"}";g=u}l+=c+"{"+g+"}\r\n",document.getElementById("main").style.display="block",document.getElementById("loader_div").style.display="none",r++}cssDone||($("head").append("<style>"+l+"</style>"),console.log(l),cssDone=!0,globalcss=null)}else globalcss=globalcss.concat(n),cssCount++}for(var r in i)console.log(i[r].fields["Custom.Text"]),get(config.url_proj+"/"+config.path_workitem.replaceAllEx("###ids###",i[r].fields["System.Id"]),getGeneric,"getGeneric"+i[r].fields["System.Id"])}function loadRelation(e,t){if(e.length>0){var n=[];for(var i in e)"System.LinkTypes.Hierarchy-Forward"==e[i].rel&&n.push(parseInt(e[i].url.split("/").pop()));if(!(n.length<1)){if("BatchCss"==t){cssDone=!1;for(var i=0;i<n.length;i+=200){let a=n.slice(i,i+200);if(a.length>0){var r=JSON.stringify({ids:a,fields:["System.Id","System.Title","Custom.Text","Custom.Data","Custom.AuxData","Custom.Type","Custom.Order"]});post(config.url_org+"/Css/"+config.path_batch,r,getRelation,"getRelation")}}}else for(var i in e)"System.LinkTypes.Hierarchy-Forward"==e[i].rel&&get(e[i].url,getGeneric,"getGeneric"+n[i])}}}